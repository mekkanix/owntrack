!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OwnTrack=t()}(this,(function(){"use strict";var e=(e,t)=>{(Array.isArray(t)||"object"==typeof t&&null!==t)&&(t=JSON.stringify(t)),localStorage.setItem(e,t)},t=e=>{const t=localStorage.getItem(e);if(!t)return null;if(["true","false"].includes(t))return"true"===t;if(!isNaN(Number(t)))return Number(t);try{return JSON.parse(t)}catch(e){}return String(t)};const s="http://www.w3.org/2000/svg",i=()=>{const e=document.createElementNS(s,"svg");e.setAttribute("version","1.1"),e.setAttribute("viewBox","0 0 24 24");const t=document.createElementNS(s,"line");t.setAttribute("x1","1"),t.setAttribute("y1","23"),t.setAttribute("x2","23"),t.setAttribute("y2","1");const i=document.createElementNS(s,"line");return i.setAttribute("x1","1"),i.setAttribute("y1","1"),i.setAttribute("x2","23"),i.setAttribute("y2","23"),t.setAttribute("stroke-width","3"),i.setAttribute("stroke-width","3"),t.setAttribute("stroke","#000000"),i.setAttribute("stroke","#000000"),e.append(t),e.append(i),e.classList.add("ot-icn"),e},n=()=>{const e=document.createElementNS(s,"svg");e.setAttribute("version","1.1"),e.setAttribute("viewBox","0 0 1282.93 709.16");const t=document.createElementNS(s,"polygon"),i=document.createElementNS(s,"polygon");return t.setAttribute("points","501.45 0 207.71 0 0 207.71 0 501.45 207.71 709.16 501.45 709.16 709.16 501.45 709.16 207.71 501.45 0"),t.setAttribute("fill","#88181a"),i.setAttribute("points","1282.93 131.04 1150.56 0 646.02 0 778.38 131.04 915.5 131.04 915.5 709.16 1046.54 576.8 1046.54 131.04 1282.93 131.04"),i.setAttribute("fill","#6e6e6e"),e.append(t),e.append(i),e.classList.add("ot-logo"),e},r=(e,t=[],s={})=>{const i=document.createElement(e);for(const e of t)i.classList.add(e);for(const[e,t]of Object.entries(s))i.setAttribute(e,t);return i},a=e=>({close:i()}[e]);class o{constructor(e,t){this.name=e,this._l=t}get label(){return this._l||this.name}}const c="owntrack_uc";class d{constructor(){this._services=[],this._consents=[],this._scriptQueue=[],this._initTaskQueue=[],this._tasksQueue=[],this._rcService={isEditable:!1,name:"_rc",description:"This website uses some cookies needed for it to work. They cannot be disabled.",consent:{value:!0,reviewed:!0},ts:new o("_rc","Required cookies")},this._consents=t(c)||[]}wrapService({name:e,label:t,type:s,description:i,scriptUrl:n,onInit:r,handlers:a}){n&&this._scriptQueue.push({srv:e,url:n,processed:!1,attachedHandler:!1}),r&&this._initTaskQueue.push({srv:e,handler:r,processed:!1});const c=new o(e,t);if(a)for(const[t,s]of Object.entries(a))c[t]=this._getWrappedTrackingFn(e,s);return this._services.push(c),{isEditable:!0,name:e,type:s,description:i,consent:{value:this.hasConsent(e),reviewed:this.isReviewed(e)},ts:c}}_getWrappedTrackingFn(e,t){return(...s)=>{this._tasksQueue.push({srv:e,handler:t,args:s,processed:!1}),this._execTaskQueue()}}_execScriptTaskQueue(){this._scriptQueue=this._scriptQueue.map((e=>{if(!e.processed&&!e.attachedHandler&&this.isReviewed(e.srv)&&this.hasConsent(e.srv)){const t=(e=>{const t=document.createElement("script");return t.setAttribute("type","text/javascript"),t.setAttribute("src",e),t})(e.url);t.addEventListener("load",(()=>{e.processed=!0,console.log(`[${e.srv}] script task done`),this._execScriptTaskQueue(),this._execInitTaskQueue(),this._execTaskQueue()})),document.head.append(t),e.attachedHandler=!0}return e})).filter((e=>!e.processed))}_execInitTaskQueue(){this._initTaskQueue=this._initTaskQueue.map((e=>{const t=this._scriptQueue.filter((t=>t.srv===e.srv));return(!t.length||t[0].processed)&&this.isReviewed(e.srv)&&this.hasConsent(e.srv)&&(e.handler(),e.processed=!0,console.log(`[${e.srv}] init task done`),this._execTaskQueue()),e})).filter((e=>!e.processed))}_execTaskQueue(){this._tasksQueue=this._tasksQueue.map((e=>{const t=this._scriptQueue.filter((t=>t.srv===e.srv)),s=!t.length||t[0].processed,i=this._initTaskQueue.filter((t=>t.srv===e.srv)),n=!i.length||i[0].processed;return s&&n&&this.isReviewed(e.srv)&&this.hasConsent(e.srv)&&(e.handler(...e.args),e.processed=!0,console.log(`[${e.srv}] task done`)),e})).filter((e=>!e.processed))}store(){const t=this._services.map((e=>({srv:e.name,v:!!this._consents.some((t=>t.srv===e.name))&&this._consents.filter((t=>t.srv===e.name))[0].v,r:!!this._consents.some((t=>t.srv===e.name))&&this._consents.filter((t=>t.srv===e.name))[0].r})));this._consents=t,e(c,t)}init(){this._execScriptTaskQueue(),this._execInitTaskQueue(),this._execTaskQueue()}setConsent(e,t=""){if(t)this._consents=this._consents.map((s=>(s.srv===t&&(s.v=e,s.r=!0),s)));else for(const t of this._consents)t.v=e,t.r=!0;this.store(),this._execScriptTaskQueue(),this._execInitTaskQueue(),this._execTaskQueue()}setUnreviewedConsents(e){this._consents=this._consents.map((t=>(t.r||(t.v=e),t.r=!0,t))),this.store(),this._execScriptTaskQueue(),this._execInitTaskQueue(),this._execTaskQueue()}getRCService(){return this._rcService}getTrackingServices(){return this._services.map((e=>({isEditable:!0,name:e.name,consent:{value:!!this._consents.some((t=>t.srv===e.name))&&this._consents.filter((t=>t.srv===e.name))[0].v,reviewed:!!this._consents.some((t=>t.srv===e.name))&&this._consents.filter((t=>t.srv===e.name))[0].r},ts:e})))}isReviewed(e=""){return e?!!this._consents.filter((t=>t.srv===e&&t.r)).length:this._consents.every((e=>e.r))}hasConsent(e=""){return e?!!this._consents.filter((t=>t.srv===e&&t.v)).length:this._consents.every((e=>e.v))}hasGlobalConsent(e){return this._consents.every((t=>t.v===e))}}const l=(e,t,s="")=>{let i=null;for(let n=0;n<e.children.length;n++){const r=e.children[n],a=r.hasAttribute(t),o=r.getAttribute(t);a&&(!s||s&&o===s)?i=r:i||(i=l(r,t,s))}return i};class h{constructor(e){this._services=[],this._triggerDisplayed=!1,this._manualOpen=!1,this._entryDisplayed=!1,this._settingsDisplayed=!1,this._d={r:r("div"),tr:r("div"),er:r("div"),sr:r("div"),sc:r("div"),srvr:r("div")},this._trackingGuard=e}_initBase(){this._d.r=document.createElement("div"),this._d.r.classList.add("ot-root")}_initTrigger(){const e=r("div",["ot-trigger"]),t=r("p",["ot-trigger__info"]);t.innerHTML="Tracking<br />Protection",e.append(n()),e.append(t),this._d.tr.classList.add("ot-trigger-container"),this._d.tr.append(e),this._d.tr.addEventListener("click",this._onMainTriggerClick.bind(this))}_initEntry(){this._d.er=r("div",["ot-entry-wrapper"]);const e=r("div",["ot-entry"]),t=r("div",["ot-entry__notice"]);t.innerHTML="<p>This website uses cookies &amp; analytics for tracking and/or advertising purposes. You can choose to accept them or not.</p>",e.append(t);const s=[{t:"Settings",c:["otua-settings","ot-btn","ot-ghost"],a:{"data-ot-entry-ua":"settings"},h:this._onSettingsOpenClick.bind(this)},{t:"Deny",c:["otua-deny","ot-btn"],a:{"data-ot-entry-ua":"deny"},h:this._onEDenyAllServicesClick.bind(this)},{t:"Allow",c:["otua-allow","ot-btn"],a:{"data-ot-entry-ua":"allow"},h:this._onEAllowAllServicesClick.bind(this)},{i:"close",c:["otua-close","ot-btn","ot-btn-icn","ot-ghost","ot-rounded"],a:{"data-ot-entry-ua":"close"},h:this._onMainCloseClick.bind(this)}],i=r("div",["ot-entry__btns"]);for(const e of s){let t;e.t?(t=r("button",e.c,e.a),t.innerHTML=e.t):e.i&&(t=r("div",e.c,e.a),t.append(a("close"))),t.addEventListener("click",e.h),i.append(t)}e.append(i),this._d.er.append(e)}_initSettingsBase(){this._d.sr.classList.add("ot-settings-overlay"),this._d.sc.classList.add("ot-settings")}_initSettingsHeader(){const e=r("div",["ot-settings__close","ot-btn","ot-btn-icn","ot-ghost","ot-rounded"]);e.addEventListener("click",this._onSettingsCloseClick.bind(this));const t=a("close");e.append(t);const s=r("h1");s.innerHTML="Tracking Settings";const i=r("p",["ot-settings__notice"]);i.innerHTML="Here you can manage tracking/analytics acceptance for each service.<br/> You can also accept or deny tracking for all services at once.";const n=r("div",["ot-settings__main-actions"]),o=[{t:"Deny all",c:["otua-deny","ot-btn","otua-deny"],a:{"data-ot-settings-ua":"deny"},h:this._onSDenyAllServicesClick.bind(this)},{t:"Allow all",c:["otua-allow","ot-btn","otua-allow"],a:{"data-ot-settings-ua":"allow"},h:this._onSAllowAllServicesClick.bind(this)}],c=r("div",["ot-settings__main-actions__btns"]);for(const e of o){const t=r("button",e.c,e.a);t.innerHTML=e.t,t.addEventListener("click",e.h),c.append(t)}n.append(c),this._d.sc.append(e),this._d.sc.append(s),this._d.sc.append(i),this._d.sc.append(n)}_initSettingsServices(){this._d.srvr.classList.add("ot-settings__services");for(const e of this._services){const t=r("div",["ot-settings__service"],{"data-ot-srv":e.name}),s=r("div",["ot-settings__service-header"]),i=r("p",["ot-settings__service-name"]),n=r("div",["ot-settings__service-content"]),a=r("div",["ot-settings__service-info"]);let o,c,d,l;if(e.type&&(o=r("p",["ot-settings__service-type"]),o.innerHTML=e.type),i.innerHTML=e.ts.label,s.append(i),o&&s.append(o),e.description&&(c=r("div",["ot-settings__service-desc"]),c.innerHTML=e.description),e.isEditable&&(d=r("div",["ot-settings__service-state"],{"data-ot-srv-state":""})),c&&a.append(c),d&&a.append(d),e.isEditable){l=r("div",["ot-settings__service-btns"]);const t=[{t:"Deny",c:["otua-deny","ot-btn","ot-btn-sm"],a:{"data-ot-settings-srv-ua":"deny"},h:this._onDenyServiceClick.bind(this)},{t:"Allow",c:["otua-allow","ot-btn","ot-btn-sm"],a:{"data-ot-settings-srv-ua":"allow"},h:this._onAllowServiceClick.bind(this)}];for(const s of t){const t=r("button",s.c,s.a);t.innerHTML=s.t,t.addEventListener("click",(t=>s.h(e.name,t))),l.append(t)}}n.append(a),l&&n.append(l),t.append(s),t.append(n),this._d.srvr.append(t)}this._d.sc.append(this._d.srvr)}_initSettingsFooter(){const e=r("div",["ot-settings__cp"]),t=r("div",["ot-settings__cp-info"]);t.innerHTML="Powered by OwnTrack";const s=r("div",["ot-settings__cp-logo"]);s.append(n()),e.append(t),e.append(s),this._d.sc.append(e)}_render(){this._triggerDisplayed?this._d.r.append(this._d.tr):this._d.tr.remove(),this._entryDisplayed?this._d.r.append(this._d.er):this._d.er.remove(),this._settingsDisplayed?(this._d.sr.append(this._d.sc),this._d.r.append(this._d.sr)):this._d.sr.remove();const e=l(this._d.r,"data-ot-entry-ua","settings");e&&(this._settingsDisplayed?e.classList.add("ot-active"):e.classList.remove("ot-active"));const t=l(this._d.r,"data-ot-entry-ua","deny"),s=l(this._d.r,"data-ot-entry-ua","allow"),i=l(this._d.sr,"data-ot-settings-ua","deny"),n=l(this._d.sr,"data-ot-settings-ua","allow");null==t||t.classList.remove("ot-active"),null==s||s.classList.remove("ot-active"),null==i||i.classList.remove("ot-active"),null==n||n.classList.remove("ot-active"),this._trackingGuard.isReviewed()&&(this._trackingGuard.hasGlobalConsent(!1)?(null==t||t.classList.add("ot-active"),null==i||i.classList.add("ot-active")):this._trackingGuard.hasGlobalConsent(!0)&&(null==s||s.classList.add("ot-active"),null==n||n.classList.add("ot-active")));for(const e of this._services){const t=l(this._d.srvr,"data-ot-srv",e.name);if(t){const s=l(t,"data-ot-srv-state");s&&(s.innerHTML=this._getServiceStateLabel(e));const i=l(t,"data-ot-settings-srv-ua","deny"),n=l(t,"data-ot-settings-srv-ua","allow");null==i||i.classList.remove("ot-active"),e.consent.reviewed&&!e.consent.value&&(null==i||i.classList.add("ot-active")),null==n||n.classList.remove("ot-active"),e.consent.reviewed&&e.consent.value&&(null==n||n.classList.add("ot-active"))}}}_onMainTriggerClick(){this._triggerDisplayed=!1,this._entryDisplayed=!0,this._manualOpen=!0,this._render()}_onMainCloseClick(){this._trackingGuard.setUnreviewedConsents(!1),this._services=this._trackingGuard.getTrackingServices(),this._triggerDisplayed=!0,this._entryDisplayed=!1,this._settingsDisplayed=!1,this._manualOpen=!1,this._render()}_onSettingsOpenClick(){this._settingsDisplayed=!0,this._render()}_onSettingsCloseClick(){this._settingsDisplayed=!1,this._manualOpen||(this._triggerDisplayed=this._trackingGuard.isReviewed(),this._entryDisplayed=!this._trackingGuard.isReviewed()),this._render()}_onEAllowAllServicesClick(){this._trackingGuard.setConsent(!0),this._triggerDisplayed=!0,this._entryDisplayed=!1,this._services=this._trackingGuard.getTrackingServices(),this._render()}_onEDenyAllServicesClick(){this._trackingGuard.setConsent(!1),this._triggerDisplayed=!0,this._entryDisplayed=!1,this._services=this._trackingGuard.getTrackingServices(),this._render()}_onSAllowAllServicesClick(){this._trackingGuard.setConsent(!0),this._services=this._trackingGuard.getTrackingServices(),this._render()}_onSDenyAllServicesClick(){this._trackingGuard.setConsent(!1),this._services=this._trackingGuard.getTrackingServices(),this._render()}_onAllowServiceClick(e){this._trackingGuard.setConsent(!0,e),this._services=this._trackingGuard.getTrackingServices(),this._render()}_onDenyServiceClick(e){this._trackingGuard.setConsent(!1,e),this._services=this._trackingGuard.getTrackingServices(),this._render()}_getServiceStateLabel(e){return e.consent.reviewed?e.consent.value?"Allowed":"Denied":"Pending"}mount(){this._render(),document.body.append(this._d.r)}setServices(e){this._services=e}init(){this._triggerDisplayed=this._trackingGuard.isReviewed(),this._entryDisplayed=!this._trackingGuard.isReviewed(),this._initBase(),this._initTrigger(),this._initEntry(),this._initSettingsBase(),this._initSettingsHeader(),this._initSettingsServices(),this._initSettingsFooter()}}class _{constructor(e){this._trackingGuard=new d,this._services=[],this._dp=new h(this._trackingGuard);for(const t of e.services)this._services.push(this._trackingGuard.wrapService(t));this._trackingGuard.store(),this._trackingGuard.init(),this._dp.setServices([this._trackingGuard.getRCService(),...this._services]),this._dp.init(),window.addEventListener("DOMContentLoaded",(()=>{this._dp.mount()}))}service(e){if(((e,t)=>{try{if(!t.includes(e))throw new Error(`OwnTrack: '${e}' service is not registered.`)}catch(e){return console.error(e.message),!1}return!0})(e,this._services.map((e=>e.name))))return this._services.filter((t=>t.name===e))[0].ts}}return e=>(!window.__owntrack&&(e=>{try{if(!e)throw new Error("OwnTrack: A configuration object is required at first call.");if(!e.services)throw new Error("OwnTrack: 'services' is required.");if(!Array.isArray(e.services))throw new Error("OwnTrack: 'services' must be an array.");if(e.services)for(const t of e.services){if(!t.name)throw new Error(`OwnTrack: Service [${t.name}]: 'name' is required.`);if(e.services.filter((e=>e.name===t.name)).length>1)throw new Error("OwnTrack: Service names must be unique.");if(!t.scriptUrl&&!t.onInit&&!t.handlers)throw new Error(`OwnTrack: Service [${t.name}]' must contain at least one of the following properties: scriptUrl, onInit, handlers.`);if(t.label&&"string"!=typeof t.label)throw new Error(`OwnTrack: Service [${t.name}]: 'label' must be a string.`);if(t.type&&"string"!=typeof t.type)throw new Error(`OwnTrack: Service [${t.name}]: 'type' must be a string.`);if(t.description&&"string"!=typeof t.description)throw new Error(`OwnTrack: Service [${t.name}]: 'description' must be a string.`);if(t.scriptUrl&&"string"!=typeof t.scriptUrl)throw new Error(`OwnTrack: Service [${t.name}]: 'scriptUrl' must be a string.`);if(t.onInit&&"function"!=typeof t.onInit)throw new Error(`OwnTrack: Service [${t.name}]: 'onInit' must be a function.`);if(t.handlers&&"object"!=typeof t.handlers)throw new Error(`OwnTrack: Service [${t.name}]: 'handlers' must be an object.`);if(t.handlers&&Object.entries(t.handlers).some((e=>"function"!=typeof e[1])))throw new Error(`OwnTrack: Service [${t.name}]: 'handlers' properties must be function declarations.`)}}catch(e){return console.error(e.message),!1}return!0})(e)&&(window.__owntrack=new _(e)),window.__owntrack)}));
